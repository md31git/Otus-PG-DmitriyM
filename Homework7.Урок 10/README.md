## 1.Настройте сервер так, чтобы в журнал сообщений сбрасывалась информация о блокировках, удерживаемых более 200 миллисекунд. Воспроизведите ситуацию, при которой в журнале появятся такие сообщения.
### Проверяем и меняем настройку конфигурации: включаем параметр log_lock_waits, чтобы информация по блокировкам сбрасывалась в Log и устанавливаем порог длительности блокировки для записи в log deadlock_timeout 200 миллисекунд
```Bash
sudo -u postgres psql -d db -p 5434
SHOW log_lock_waits;
SHOW deadlock_timeout;
ALTER SYSTEM SET log_lock_waits = on;
ALTER SYSTEM SET deadlock_timeout = 200;
SELECT pg_reload_conf();
SHOW log_lock_waits;
SHOW deadlock_timeout;
```
![image](https://github.com/user-attachments/assets/f8b69514-c63d-404f-ab3b-fd5fc38fcfa0)

### В первом соединении запускаем транзакцию и операцию на обновление записи, а затем открываем второе соединение и также в открытой транзакции пытаемся обновить ту же запись. Но т.к. у нас возникает эксклюзивная блокировка записи, то второе соединение в ожидании завершения первой и получается что у нас блокировка "висит" более 0.2 сек, пока не будет завершена/отменена первая транзакция.
В первой сессии ставим задержку 5 сек, чтобы наверняка сработал перехват блокировки в лог файл.

**1 сессия**
```Bash
begin;
update test.test set name='тест2' where id=5;
SELECT pg_sleep(5);
commit;
```
**2 сессия**
```Bash
begin;
update test.test set name='тест3' where id=5;
commit;
```
![image](https://github.com/user-attachments/assets/cebc8f81-3a12-4de8-b9b9-2dea10e0794d)

### Открываем третью сесиию для удобства и запрашиваем последние 10 строк из лог файла Postgresql. 
**3 сессия**
```Bash
sudo tail -n 10 /var/log/postgresql/postgresql-14-main3.log
``
![image](https://github.com/user-attachments/assets/77a9533b-7dc4-4724-a179-cc093c2df73d)

В лог файле видно (выделено желтым), что процесс 26381 блокировал процесс 29332 транзакцией 731  и держал 20 сек (больше 5 сек, т.к. запускались команды по отдельности)

## 2.Смоделируйте ситуацию обновления одной и той же строки тремя командами UPDATE в разных сеансах. Изучите возникшие блокировки в представлении pg_locks и убедитесь, что все они понятны. Пришлите список блокировок и объясните, что значит каждая.
## 3.Воспроизведите взаимоблокировку трех транзакций. Можно ли разобраться в ситуации постфактум, изучая журнал сообщений?
## 4.Могут ли две транзакции, выполняющие единственную команду UPDATE одной и той же таблицы (без where), заблокировать друг друга?
